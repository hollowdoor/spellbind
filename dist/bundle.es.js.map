{"version":3,"file":"bundle.es.js","sources":["../src/vars.js","../src/index.js"],"sourcesContent":["import WeakMap from 'es6-weak-map';\n\nexport const top = typeof global !== 'undefined'\n? global\n: typeof self !== 'undefined'\n? self\n: window.top;\n\nif(typeof top.__signal_record__ === 'undefined'){\n    Object.defineProperty(top, '__signal_record__', {\n        value: new WeakMap()\n    });\n}\n\nexport const record = top.__signal_record__;\n","import { record } from './vars.js';\n\nclass Slot {\n    constructor(signal, listener, ctx, once = false){\n        this.signal = signal;\n        this.next = null;\n\n        this.prev = signal.last;\n        signal.last = signal.last.next = this;\n\n        this.listener = listener;\n        this.ctx = ctx;\n        this.once = once;\n    }\n    remove(){\n        if(this.signal.last.listener === this.listener){\n            this.signal.last = this.prev;\n        }\n\n        this.prev.next = this.next;\n    }\n}\n\nclass Signal {\n    constructor(context){\n        this.ctx = context;\n        this.start = {next:null};\n        this.last = this.start;\n    }\n    add(listener, ctx = null, once){\n\n        return new Slot(\n            this,\n            listener,\n            ctx || this.ctx,\n            once\n        );\n    }\n    dispatch(...args){\n        let next = this.start;\n\n        while(next = next.next){\n            next.listener.apply(\n                next.ctx,\n                args\n            );\n\n            if(next.once){\n                next.remove();\n            }\n        }\n\n        return this;\n    }\n    remove(listener){\n        let next = this.start;\n\n        while(next = next.next){\n            if(next.listener === listener){\n                next.remove();\n            }\n        }\n\n        return this;\n    }\n    removeAll(){\n        this.start = {};\n        return this;\n    }\n    once(listener, ctx = null){\n        this.add(listener, ctx, true);\n        return this;\n    }\n}\n\nexport function connect(obj, name){\n    if(!record.has(obj)){\n        record.set(obj, {});\n    }\n\n    let signals = record.get(obj);\n\n    if(signals[name] === void 0){\n        signals[name] = new Signal(obj);\n    }\n\n    return signals[name];\n}\n\nclass SignalCollection {\n    constructor(signals){\n        this.signals = signals;\n    }\n    remove(){\n        for(let i=0; i<this.signals.length; i++){\n            this.signals[i].remove();\n        }\n    }\n}\n\nconnect.init = function(obj, listeners, ctx){\n    let keys = Object.keys(listeners);\n    let signals = [];\n\n    for(let i=0; i<keys.length; i++){\n        signals.push(\n            connect(obj, keys[i])\n            .add(listeners[keys[i]], ctx)\n        );\n    }\n\n    return new SignalCollection(signals);\n};\n"],"names":["const","let"],"mappings":"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"}